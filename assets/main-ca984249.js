import{b as u}from"./init-d40afb2b.js";const c="opened_dors_zone",l="closed_dors_zone",i="zone",W="entry_zone",f="exit_zone",m=6,d=5,s="jitsiSalle",b=["450, 240","440, 300","870, 300","700, 300","720, 240"],p=()=>Math.floor(Math.random()*100)+1,$=o=>{const e=o.split("/").find(r=>r.startsWith("hopital-"));return e||null},h=()=>{WA.player.teleport(160,195),WA.state["room-state"]===void 0&&(WA.state["room-state"]={patients:[],doctors:[]});const o=WA.state.loadVariable("waiting-room"),t=$(WA.room.id);o||WA.state.saveVariable("waiting-room",{actualRoom:t}).catch(e=>console.error("Something went wrong while saving variable waiting-room",e));for(let e=1;e<=d;e++){const r=WA.state["room-state"];WA.state["room-state"]={...r,[`${s}${e}`]:{...r[`${s}${e}`],patient:null,doctor:null,coordinates:b[e-1]}}}WA.ui.actionBar.addButton({id:"change-btn",label:"Change hospital",callback:()=>{WA.player.teleport(361,39)}})},y=()=>{WA.room.area.onEnter("register").subscribe(()=>{WA.player.state.informations||(WA.controls.disablePlayerControls(),WA.ui.openPopup("registerPopup","Bienvenue dans Virtual Health",[{label:"Suivant",className:"normal",callback:t=>{t.close(),WA.ui.openPopup("registerPopup","Vous pouvez commencer par remplir notre formulaire qu'on sache si vous êtes un patient ou un médécin.",[{label:"Suivant",className:"normal",callback:e=>{e.close(),WA.player.moveTo(76,273)}}])}}]))})},O=()=>{WA.room.onEnterLayer("stairs_zone").subscribe(()=>{const o=`hopital-${p()}`;WA.state.saveVariable("waiting-room",{actualRoom:o}).catch(n=>console.error("Something went wrong while saving variable waiting-room",n));const t=new URL(WA.room.id),e=t.pathname,r=e.indexOf("hopital-");if(r!==-1){const n=e.indexOf("/",r);if(n!==-1){const a=e.substring(0,r)+o+e.substring(n),A=new URL(t.origin+a+t.search);WA.nav.goToRoom(A.href)}}})},g=()=>{for(let o=1;o<=d;o++)WA.room.area.onEnter(`${s}${o}`).subscribe(()=>{const t=WA.state["room-state"],e=t.doctors.find(a=>a.id===WA.player.playerId),r=t.patients.find(a=>a.id===WA.player.playerId),n=!!e;WA.state["room-state"]={...t,[`${s}${o}`]:{...t[`${s}${o}`],patient:n?null:r,doctor:n?e:null}}}),WA.room.area.onLeave(`${s}${o}`).subscribe(()=>{const t=WA.state["room-state"],e=t.doctors.find(a=>a.id===WA.player.playerId),r=t.patients.find(a=>a.id===WA.player.playerId),n=!!e;WA.state["room-state"]={...t,[`${s}${o}`]:{...t[`${s}${o}`],patient:n?r:null,doctor:n?null:e}}})},_=()=>{for(let o=1;o<=m;o++)WA.room.showLayer(`dors/${l}${o}`),WA.room.hideLayer(`dors/${c}${o}`),WA.state[`${i}${o}`]={doorState:!1,nbrOfUsers:0}},I=async()=>{for(let o=1;o<=m;o++)WA.room.onEnterLayer(`floor_entry_exit/${W}${o}`).subscribe(async()=>{const t=WA.state[`${i}${o}`];if(t&&t.nbrOfUsers<2){const e=S(),r=R(o),n=w(o);(e&&!r||!e&&!n)&&(WA.state[`${i}${o}`]={doorState:!(t!=null&&t.doorState),nbrOfUsers:t==null?void 0:t.nbrOfUsers})}}),WA.room.onEnterLayer(`floor_entry_exit/${f}${o}`).subscribe(async()=>{const t=WA.state[`${i}${o}`];t&&(WA.state[`${i}${o}`]={doorState:!(t!=null&&t.doorState),nbrOfUsers:(t==null?void 0:t.nbrOfUsers)+1}),t.nbrOfUsers===2&&(WA.state[`${i}${o}`]={doorState:!(t!=null&&t.doorState),nbrOfUsers:(t==null?void 0:t.nbrOfUsers)-1})})},E=()=>{for(let o=1;o<=m;o++)WA.state.onVariableChange(`${i}${o}`).subscribe(t=>{t.doorState?(WA.room.showLayer(`dors/${c}${o}`),WA.room.hideLayer(`dors/${l}${o}`)):(WA.room.showLayer(`dors/${l}${o}`),WA.room.hideLayer(`dors/${c}${o}`))})},S=()=>{const o=WA.state["room-state"],t=WA.player.playerId,e=o.doctors.filter(r=>{if(r.id===t)return r});return console.log(e,"doctors"),e.length},R=o=>WA.state["room-state"][`${s}${o}`].doctor!==null,w=o=>WA.state["room-state"][`${s}${o}`].patient!==null;WA.onInit().then(async()=>{h();let o;WA.room.area.onEnter("getinfo").subscribe(async()=>{WA.player.state.informations||(o=await WA.ui.website.open({url:"./formulaire.html",position:{vertical:"top",horizontal:"middle"},size:{height:"120vh",width:"50vw"},margin:{top:"3vh"},allowApi:!0}))}),WA.room.area.onLeave("getinfo").subscribe(()=>{o.close()}),u().then(()=>{console.log("Scripting API Extra ready")}).catch(t=>console.error(t)),_(),I(),E(),y(),O(),g()}).catch(o=>console.error(o));WA.room.area.onEnter("visibleNote").subscribe(async()=>{console.log("Entering visibleNote layer")});
