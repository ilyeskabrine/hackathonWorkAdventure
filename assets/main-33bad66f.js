import{b as m}from"./init-d40afb2b.js";const l="opened_dors_zone",c="closed_dors_zone",n="zone",u="entry_zone",b="exit_zone",A=6,d=5,r="jitsiSalle",W=["450, 240","440, 300","870, 300","700, 300","720, 240"],p=()=>Math.floor(Math.random()*100)+1,$=o=>{const e=o.split("/").find(a=>a.startsWith("hopital-"));return e||null},f=()=>{WA.player.teleport(160,195),WA.state["room-state"]===void 0&&(WA.state["room-state"]={patients:[],doctors:[]});const o=WA.state.loadVariable("waiting-room"),t=$(WA.room.id);o||WA.state.saveVariable("waiting-room",{actualRoom:t}).catch(e=>console.error("Something went wrong while saving variable waiting-room",e));for(let e=1;e<=d;e++){const a=WA.state["room-state"];WA.state["room-state"]={...a,[`${r}${e}`]:{...a[`${r}${e}`],patient:null,doctor:null,coordinates:W[e-1]}}}WA.ui.actionBar.addButton({id:"change-btn",label:"Change hospital",callback:()=>{WA.player.teleport(361,39)}})},y=()=>{WA.room.area.onEnter("register").subscribe(()=>{WA.player.state.informations||(WA.controls.disablePlayerControls(),WA.ui.openPopup("registerPopup","Bienvenue dans Virtual Health",[{label:"Suivant",className:"normal",callback:t=>{t.close(),WA.ui.openPopup("registerPopup","Vous pouvez commencer par remplir notre formulaire qu'on sache si vous êtes un patient ou un médécin.",[{label:"Suivant",className:"normal",callback:e=>{e.close(),WA.player.moveTo(76,273)}}])}}]))})},h=()=>{WA.room.onEnterLayer("stairs_zone").subscribe(()=>{const o=`hopital-${p()}`;WA.state.saveVariable("waiting-room",{actualRoom:o}).catch(t=>console.error("Something went wrong while saving variable waiting-room",t)),WA.nav.goToRoom(`https://play.workadventu.re/_/${o}/localhost:5173/map.tmj`)})},O=()=>{for(let o=1;o<=d;o++)WA.room.area.onEnter(`${r}${o}`).subscribe(()=>{const t=WA.state["room-state"],e=t.doctors.find(s=>s.id===WA.player.playerId),a=t.patients.find(s=>s.id===WA.player.playerId),i=!!e;WA.state["room-state"]={...t,[`${r}${o}`]:{...t[`${r}${o}`],patient:i?null:a,doctor:i?e:null}}}),WA.room.area.onLeave(`${r}${o}`).subscribe(()=>{const t=WA.state["room-state"],e=t.doctors.find(s=>s.id===WA.player.playerId),a=t.patients.find(s=>s.id===WA.player.playerId),i=!!e;WA.state["room-state"]={...t,[`${r}${o}`]:{...t[`${r}${o}`],patient:i?a:null,doctor:i?null:e}}})},g=()=>{for(let o=1;o<=A;o++)WA.room.showLayer(`dors/${c}${o}`),WA.room.hideLayer(`dors/${l}${o}`),WA.state[`${n}${o}`]={doorState:!1,nbrOfUsers:0}},_=async()=>{for(let o=1;o<=A;o++)WA.room.onEnterLayer(`floor_entry_exit/${u}${o}`).subscribe(async()=>{const t=WA.state[`${n}${o}`];t&&t.nbrOfUsers<2&&(WA.state[`${n}${o}`]={doorState:!(t!=null&&t.doorState),nbrOfUsers:t==null?void 0:t.nbrOfUsers})}),WA.room.onEnterLayer(`floor_entry_exit/${b}${o}`).subscribe(async()=>{const t=WA.state[`${n}${o}`];t&&(WA.state[`${n}${o}`]={doorState:!(t!=null&&t.doorState),nbrOfUsers:(t==null?void 0:t.nbrOfUsers)+1}),t.nbrOfUsers===2&&(WA.state[`${n}${o}`]={doorState:!(t!=null&&t.doorState),nbrOfUsers:(t==null?void 0:t.nbrOfUsers)-1})})},E=()=>{for(let o=1;o<=A;o++)WA.state.onVariableChange(`${n}${o}`).subscribe(t=>{t.doorState?(WA.room.showLayer(`dors/${l}${o}`),WA.room.hideLayer(`dors/${c}${o}`)):(WA.room.showLayer(`dors/${c}${o}`),WA.room.hideLayer(`dors/${l}${o}`))})};WA.onInit().then(async()=>{f();let o;WA.room.area.onEnter("getinfo").subscribe(async()=>{WA.player.state.informations||(o=await WA.ui.website.open({url:"./formulaire.html",position:{vertical:"top",horizontal:"middle"},size:{height:"120vh",width:"50vw"},margin:{top:"3vh"},allowApi:!0}))}),WA.room.area.onLeave("getinfo").subscribe(()=>{o.close()}),m().then(()=>{console.log("Scripting API Extra ready")}).catch(t=>console.error(t)),g(),_(),E(),y(),h(),O()}).catch(o=>console.error(o));WA.room.area.onEnter("visibleNote").subscribe(async()=>{console.log("Entering visibleNote layer")});
