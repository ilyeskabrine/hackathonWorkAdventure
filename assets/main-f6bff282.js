import{b as u}from"./init-d40afb2b.js";const l="opened_dors_zone",c="closed_dors_zone",i="zone",b="entry_zone",W="exit_zone",d=6,A=5,s="jitsiSalle",p=["450, 240","440, 300","870, 300","700, 300","720, 240"],f=()=>Math.floor(Math.random()*100)+1,$=t=>{const e=t.split("/").find(n=>n.startsWith("hopital-"));return e||null},h=()=>{WA.player.teleport(160,195),WA.state["room-state"]===void 0&&(WA.state["room-state"]={patients:[],doctors:[]});const t=WA.state.loadVariable("waiting-room"),o=$(WA.room.id);t||WA.state.saveVariable("waiting-room",{actualRoom:o}).catch(e=>console.error("Something went wrong while saving variable waiting-room",e));for(let e=1;e<=A;e++){const n=WA.state["room-state"];WA.state["room-state"]={...n,[`${s}${e}`]:{...n[`${s}${e}`],patient:null,doctor:null,coordinates:p[e-1]}}}WA.ui.actionBar.addButton({id:"change-btn",label:"Change hospital",callback:()=>{WA.player.teleport(361,39)}})},y=()=>{WA.room.area.onEnter("register").subscribe(()=>{WA.player.state.informations||(WA.controls.disablePlayerControls(),WA.ui.openPopup("registerPopup","Bienvenue dans Virtual Health",[{label:"Suivant",className:"normal",callback:o=>{o.close(),WA.ui.openPopup("registerPopup","Vous pouvez commencer par remplir notre formulaire qu'on sache si vous êtes un patient ou un médécin.",[{label:"Suivant",className:"normal",callback:e=>{e.close(),WA.player.moveTo(76,273)}}])}}]))})},O=()=>{WA.room.onEnterLayer("stairs_zone").subscribe(()=>{const t=`hopital-${f()}`;WA.state.saveVariable("waiting-room",{actualRoom:t}).catch(a=>console.error("Something went wrong while saving variable waiting-room",a));const o=new URL(WA.room.id),e=o.pathname,n=e.indexOf("hopital-");if(n!==-1){const a=e.indexOf("/",n);if(a!==-1){const r=e.substring(0,n)+t+e.substring(a),m=new URL(o.origin+r+o.search);WA.nav.goToRoom(m.href)}}})},g=()=>{for(let t=1;t<=A;t++)WA.room.area.onEnter(`${s}${t}`).subscribe(()=>{const o=WA.state["room-state"],e=o.doctors.find(r=>r.id===WA.player.playerId),n=o.patients.find(r=>r.id===WA.player.playerId),a=!!e;WA.state["room-state"]={...o,[`${s}${t}`]:{...o[`${s}${t}`],patient:a?null:n,doctor:a?e:null}}}),WA.room.area.onLeave(`${s}${t}`).subscribe(()=>{const o=WA.state["room-state"],e=o.doctors.find(r=>r.id===WA.player.playerId),n=o.patients.find(r=>r.id===WA.player.playerId),a=!!e;WA.state["room-state"]={...o,[`${s}${t}`]:{...o[`${s}${t}`],patient:a?n:null,doctor:a?null:e}}})},_=()=>{for(let t=1;t<=d;t++)WA.room.showLayer(`dors/${c}${t}`),WA.room.hideLayer(`dors/${l}${t}`),WA.state[`${i}${t}`]={doorState:!1,nbrOfUsers:0}},E=async()=>{for(let t=1;t<=d;t++)WA.room.onEnterLayer(`floor_entry_exit/${b}${t}`).subscribe(async()=>{const o=WA.state[`${i}${t}`];o&&o.nbrOfUsers<2&&(WA.state[`${i}${t}`]={doorState:!(o!=null&&o.doorState),nbrOfUsers:o==null?void 0:o.nbrOfUsers})}),WA.room.onEnterLayer(`floor_entry_exit/${W}${t}`).subscribe(async()=>{const o=WA.state[`${i}${t}`];o&&(WA.state[`${i}${t}`]={doorState:!(o!=null&&o.doorState),nbrOfUsers:(o==null?void 0:o.nbrOfUsers)+1}),o.nbrOfUsers===2&&(WA.state[`${i}${t}`]={doorState:!(o!=null&&o.doorState),nbrOfUsers:(o==null?void 0:o.nbrOfUsers)-1})})},S=()=>{for(let t=1;t<=d;t++)WA.state.onVariableChange(`${i}${t}`).subscribe(o=>{o.doorState?(WA.room.showLayer(`dors/${l}${t}`),WA.room.hideLayer(`dors/${c}${t}`)):(WA.room.showLayer(`dors/${c}${t}`),WA.room.hideLayer(`dors/${l}${t}`))})};WA.onInit().then(async()=>{h();let t;WA.room.area.onEnter("getinfo").subscribe(async()=>{WA.player.state.informations||(t=await WA.ui.website.open({url:"./formulaire.html",position:{vertical:"top",horizontal:"middle"},size:{height:"120vh",width:"50vw"},margin:{top:"3vh"},allowApi:!0}))}),WA.room.area.onLeave("getinfo").subscribe(()=>{t.close()}),u().then(()=>{console.log("Scripting API Extra ready")}).catch(o=>console.error(o)),_(),E(),S(),y(),O(),g()}).catch(t=>console.error(t));WA.room.area.onEnter("visibleNote").subscribe(async()=>{console.log("Entering visibleNote layer")});
